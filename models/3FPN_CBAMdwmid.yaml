# Parameters
nc: 6   # number of classes
depth_multiple: 0.33   # model depth multiple (controlla nÂ° ripetizone blocchi) (number*depth)
width_multiple: 0.5  # layer channel multiple
anchors:
  - [10,13, 16,30, 33,23]  # P3/8
  - [30,61, 62,45, 59,119]  # P4/16
  - [116,90, 156,198, 373,326]  # P5/32
# volendo posso passare 'activation'

# YOLOv5 v6.0 backbone
backbone:
  # [from, number, module, args[channel_out,kernel,stride,padding]
  [[ -1, 1, SpatialAttDownSample, [ 128, 4, 4, 0 ] ],                     # 0(stem)
   [ -1, 1, LayerNorm,'' ],                          #1
   [ -1, 3, ConvNextBlockCSP, [ 128, 3, 1, False, True ] ],           #2
   [ -1, 1, LayerNorm,'' ],                          #3 C0
   [ -1, 1, SpatialAttDownSample, [ 256, 2, 2, 0 ] ],               #4
   [ -1, 3, ConvNextBlockCSP, [ 256, 3, 1, False, True ] ],           #5
   [ -1, 1, LayerNorm,'' ],                          #6 C1
   [ -1, 1, SpatialAttDownSample, [ 512, 2, 2, 0 ] ],               #7
   [ -1, 9, ConvNextBlockCSP, [ 512, 7, 3, False, True  ] ],          #8
   [ -1, 1, LayerNorm,'' ],                          #9 C2
   [ -1, 1, SpatialAttDownSample, [ 1024, 2, 2, 0 ] ],              #10
   [ -1, 3, ConvNextBlockCSP, [ 1024, 3, 1, False, True  ] ],         #11
   [ -1, 1, SPPFConvNext, [ 1024, 5 ] ],                  #12
   [ -1, 1, LayerNorm,'' ],                          #13
  ]

# YOLOv5 v6.0 head
head:
  [ [ -1, 1, SpatialAttDownSample, [ 512, 1, 1, 0 ] ],             #14
    [ -1, 1, LayerNorm,'' ],                        #15 H3
    [ -1, 1, nn.Upsample, [ None, 2, 'nearest' ] ],      #16
    [ [ -1, 9 ], 1, Concat, [ 1 ] ],                     #17 cat C2
    [ -1, 3, C3Next1, [ 512 ] ],         #18
    [ -1, 1, nn.GELU,'' ],                               #19

    [ -1, 1, SpatialAttDownSample, [ 256, 1, 1, 0 ] ],             #20
    [ -1, 1, LayerNorm,'' ],                        #21 H4
    [ -1, 1, nn.Upsample, [ None, 2, 'nearest' ] ],      #22
    [ [ -1, 6 ], 1, Concat, [ 1 ] ],                     #23 cat C1
    [ -1, 3, C3Next1, [ 256 ] ],         #24
    [ -1, 1, nn.GELU,'' ],                        #25

    [ -1, 1, SpatialAttDownSample, [ 128, 1, 1, 0 ] ],             #26
    [ -1, 1, LayerNorm,'' ],                        #27 H5
    [ -1, 1, nn.Upsample, [ None, 2, 'nearest' ] ],      #28
    [ [ -1, 3 ], 1, Concat, [ 1 ] ],                     #29 cat C0
    [ -1, 3, C3Next1, [ 128 ] ],         #30
    [ -1, 1, LayerNorm,'' ],                        #31

    [ -1, 1, SpatialAttDownSample, [ 128, 2, 2, 0 ] ],             #32
    [ [ -1, 27 ], 1, Concat, [ 1 ] ],                    #33 cat H5
    [ -1, 3, C3Next1, [ 256 ] ],         #34
    [ -1, 1, LayerNorm,'' ],                        #35  P3

    [ -1, 1, SpatialAttDownSample, [ 256, 2, 2, 0 ] ],             #36
    [ [ -1, 21 ], 1, Concat, [ 1 ] ],                    #37 cat H4
    [ -1, 3, C3Next1, [ 512 ] ],         #38
    [ -1, 1, LayerNorm,'' ],                        #39  P4

    [ -1, 1, SpatialAttDownSample, [ 512, 2, 2, 0 ] ],             #40
    [ [ -1, 15 ], 1, Concat, [ 1 ] ],                    #41 cat H3
    [ -1, 3, C3Next1, [ 1024 ] ],        #42
    [ -1, 1, LayerNorm,'' ],                        #43  P5

    [ [ 35, 39, 43 ], 1, Detect, [ nc, anchors ] ],      #44 Detect(P3, P4, P5)
  ]
