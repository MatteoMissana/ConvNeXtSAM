# YOLOv5 ðŸš€ by Ultralytics, GPL-3.0 license

# Parameters
nc: 6  # number of classes
depth_multiple: 1.0  # model depth multiple (controlla nÂ° ripetizone blocchi) (number*depth)
width_multiple: 1.0  # layer channel multiple
anchors:
  - [10,13, 16,30, 33,23]  # P3/8
  - [30,61, 62,45, 59,119]  # P4/16
  - [116,90, 156,198, 373,326]  # P5/32
# volendo posso passare 'activation'

# YOLOv5 v6.0 backbone
backbone:
  # [from, number, module, args[channel_out,kernel,stride,padding]
  [
   [ -1, 1, CBAMdown, [128, 4, 4]],          # 0
   [ -1, 1, LayerNorm, ''],         # 1
   [ -1, 3, CSPBlock, [ 128 ] ],          # 2
   [ -1, 1, nn.Conv2d, [128, 1, 1, 0 ] ],       # 3
   [ -1, 1, LayerNorm,'' ],                     # 4
   [ -1, 1, CBAMdown, [256, 2, 2]],              # 5
   [ -1, 3, CSPBlock, [ 256 ] ],                # 6
   [ -1, 1, nn.Conv2d, [256, 1, 1, 0 ]],        # 7
   [ -1, 1, LayerNorm,'' ],                     # 8
   [ -1, 1, CBAMdown, [512, 2, 2]],              # 9
   [ -1, 9, CSPBlock, [ 512 ] ],                # 10
   [ -1, 1, nn.Conv2d, [ 512, 1, 1, 0 ] ],      # 11
   [ -1, 1, LayerNorm,'' ],                     # 12
   [ -1, 1, CBAMdown, [1024, 2, 2]],             # 13
   [ -1, 3, CSPBlock, [ 1024 ] ],               # 14
   [ -1, 1, nn.Conv2d, [ 1024, 1, 1, 0 ] ],     # 15
   [ -1, 1, SPPFConvNext, [ 1024, 5 ] ],        # 16
   [ -1, 1, LayerNorm,'' ],                     # 17
  ]

# YOLOv5 v6.0 head
head:
  [ [ -1, 1, nn.Conv2d, [ 512, 1, 1, 0 ] ],         #18
    [ -1, 1, LayerNorm,'' ],                        #19
    [ -1, 1, nn.Upsample, [ None, 2, 'nearest' ] ], #20
    [ [ -1, 10 ], 1, Concat, [ 1 ] ],                #21
    [ -1, 3, CSPFPN, [ 512 ] ],                     #22
    [ -1, 1, nn.Conv2d, [ 256, 1, 1, 0 ] ],         #23
    [ -1, 1, LayerNorm,'' ],                        #24
    [ -1, 1, nn.Upsample, [ None, 2, 'nearest' ] ], #25
    [ [ -1, 6 ], 1, Concat, [ 1 ] ],                #26
    [ -1, 3, CSPFPN, [ 256 ] ],                     #27
    [ -1, 1, LayerNorm,'' ],                        #28

    [ -1, 1, CBAMdown, [ 256, 2, 2 ] ],          #29
    [ [ -1, 23 ], 1, Concat, [ 1 ] ],               #30
    [ -1, 3, CSPFPN, [ 512 ] ],                     #31
    [ -1, 1, LayerNorm,'' ],                        #32

    [ -1, 1, CBAMdown, [ 512, 2, 2 ] ],          #33
    [ [ -1, 18 ], 1, Concat, [ 1 ] ],               #34
    [ -1, 3, CSPFPN, [ 1024 ] ],                    #35
    [ -1, 1, LayerNorm,'' ],                        #36

    [ [ 28, 32, 36 ], 1, Detect, [ nc, anchors ] ], #34 Detect(P3, P4, P5)
  ]
